---
/**
 * Individual Blog Post Page
 * Dynamic routing for all blog posts
 */
import BaseLayout from '../../layouts/BaseLayout.astro';
import AdSlot from '../../components/common/AdSlot.astro';
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
  const posts = await getCollection('blog');
  return posts.map(post => ({
    params: { slug: post.slug },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content } = await post.render();

// Category colors
const categoryColors: Record<string, string> = {
  guides: '#10b981',
  culture: '#8b5cf6',
  names: '#f59e0b',
  idols: '#ec4899',
  fun: '#06b6d4'
};

// Get related posts
const allPosts = await getCollection('blog');
const relatedPosts = allPosts
  .filter(p => p.slug !== post.slug && p.data.category === post.data.category)
  .slice(0, 3);

// Schema.org Article structured data
const articleSchema = {
  "@context": "https://schema.org",
  "@type": "Article",
  "headline": post.data.title,
  "description": post.data.description,
  "datePublished": post.data.pubDate.toISOString(),
  "dateModified": post.data.updatedDate?.toISOString() || post.data.pubDate.toISOString(),
  "author": {
    "@type": "Organization",
    "name": post.data.author
  },
  "publisher": {
    "@type": "Organization",
    "name": "K-Pop Name Generator",
    "url": "https://kpopnamegenerator.com"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": `https://kpopnamegenerator.com/blog/${post.slug}/`
  }
};
---

<BaseLayout 
  title={`${post.data.title} | K-Pop Name Generator`} 
  description={post.data.description}
  keywords={post.data.tags}
  schema={articleSchema}
>
  <div class="blog-post-page">
    <div class="container">
      <article class="post">
        <!-- Post Header -->
        <header class="post-header">
          <div class="post-meta">
            <span class="category" style={`background: ${categoryColors[post.data.category]}22; color: ${categoryColors[post.data.category]}`}>
              {post.data.category}
            </span>
            <time datetime={post.data.pubDate.toISOString()}>
              {post.data.pubDate.toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
              })}
            </time>
          </div>
          <h1>{post.data.title}</h1>
          <p class="description">{post.data.description}</p>
          {post.data.tags && (
            <div class="tags">
              {post.data.tags.map((tag: string) => (
                <span class="tag">#{tag}</span>
              ))}
            </div>
          )}
        </header>

        <AdSlot slot="article-top" />

        <!-- Post Content -->
        <div class="post-content prose">
          <Content />
        </div>

        <AdSlot slot="article-bottom" />

        <!-- Share Section -->
        <div class="share-section">
          <h3>Share this article</h3>
          <div class="share-buttons">
            <a href={`https://twitter.com/intent/tweet?text=${encodeURIComponent(post.data.title)}&url=${encodeURIComponent(`https://kpopnamegenerator.com/blog/${post.slug}/`)}`} 
               target="_blank" 
               rel="noopener noreferrer"
               class="share-btn twitter">
              ùïè Share
            </a>
            <a href={`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(`https://kpopnamegenerator.com/blog/${post.slug}/`)}`} 
               target="_blank" 
               rel="noopener noreferrer"
               class="share-btn facebook">
              Facebook
            </a>
            <button class="share-btn copy" data-url={`https://kpopnamegenerator.com/blog/${post.slug}/`}>
              üìã Copy Link
            </button>
          </div>
        </div>
      </article>

      <!-- Related Posts -->
      {relatedPosts.length > 0 && (
        <section class="related-posts">
          <h2>Related Articles</h2>
          <div class="related-grid">
            {relatedPosts.map((relatedPost) => (
              <a href={`/blog/${relatedPost.slug}/`} class="related-card">
                <span class="related-category" style={`color: ${categoryColors[relatedPost.data.category]}`}>
                  {relatedPost.data.category}
                </span>
                <h3>{relatedPost.data.title}</h3>
              </a>
            ))}
          </div>
        </section>
      )}

      <!-- CTA -->
      <section class="cta-section">
        <div class="cta-card">
          <h2>Create Your K-Pop Name Now!</h2>
          <p>Inspired by the article? Try our free generator!</p>
          <a href="/" class="btn primary">Generate My Name ‚Üí</a>
        </div>
      </section>
    </div>
  </div>
</BaseLayout>

<script>
  // Copy link functionality
  document.querySelectorAll('.share-btn.copy').forEach(btn => {
    btn.addEventListener('click', async () => {
      const url = btn.getAttribute('data-url');
      if (url) {
        await navigator.clipboard.writeText(url);
        const originalText = btn.textContent;
        btn.textContent = '‚úì Copied!';
        setTimeout(() => {
          btn.textContent = originalText;
        }, 2000);
      }
    });
  });
</script>

<style>
  .blog-post-page {
    padding: 2rem 0 4rem;
    min-height: 100vh;
  }

  .container {
    max-width: 800px;
    margin: 0 auto;
    padding: 0 1rem;
  }

  /* Post Header */
  .post-header {
    text-align: center;
    margin-bottom: 2rem;
    padding-bottom: 2rem;
    border-bottom: 1px solid var(--border);
  }

  .post-meta {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 1rem;
    margin-bottom: 1rem;
  }

  .category {
    padding: 0.25rem 0.75rem;
    border-radius: 2rem;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
  }

  .post-meta time {
    font-size: 0.875rem;
    color: var(--muted);
  }

  .post-header h1 {
    font-size: 2.25rem;
    font-weight: 800;
    line-height: 1.3;
    margin-bottom: 1rem;
    color: var(--text);
  }

  .description {
    font-size: 1.125rem;
    color: var(--muted);
    line-height: 1.6;
    margin-bottom: 1rem;
  }

  .tags {
    display: flex;
    justify-content: center;
    flex-wrap: wrap;
    gap: 0.5rem;
  }

  .tag {
    font-size: 0.8rem;
    color: var(--accent);
    background: var(--accent)11;
    padding: 0.25rem 0.75rem;
    border-radius: 1rem;
  }

  /* Post Content */
  .post-content {
    margin-bottom: 3rem;
  }

  .prose {
    line-height: 1.8;
    color: var(--text);
  }

  .prose :global(h1),
  .prose :global(h2),
  .prose :global(h3),
  .prose :global(h4) {
    margin-top: 2rem;
    margin-bottom: 1rem;
    font-weight: 700;
    color: var(--text);
  }

  .prose :global(h2) {
    font-size: 1.5rem;
    padding-bottom: 0.5rem;
    border-bottom: 2px solid var(--border);
  }

  .prose :global(h3) {
    font-size: 1.25rem;
  }

  .prose :global(p) {
    margin-bottom: 1.25rem;
  }

  .prose :global(ul),
  .prose :global(ol) {
    margin-bottom: 1.25rem;
    padding-left: 1.5rem;
  }

  .prose :global(li) {
    margin-bottom: 0.5rem;
  }

  .prose :global(a) {
    color: var(--accent);
    text-decoration: underline;
  }

  .prose :global(a:hover) {
    color: var(--accent-2);
  }

  .prose :global(blockquote) {
    border-left: 4px solid var(--accent);
    padding-left: 1rem;
    margin: 1.5rem 0;
    font-style: italic;
    color: var(--muted);
  }

  .prose :global(code) {
    background: var(--chip);
    padding: 0.2rem 0.4rem;
    border-radius: 0.25rem;
    font-size: 0.875rem;
  }

  .prose :global(pre) {
    background: var(--surface);
    border: 1px solid var(--border);
    padding: 1rem;
    border-radius: 0.5rem;
    overflow-x: auto;
    margin-bottom: 1.25rem;
  }

  .prose :global(pre code) {
    background: none;
    padding: 0;
  }

  .prose :global(table) {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 1.5rem;
  }

  .prose :global(th),
  .prose :global(td) {
    border: 1px solid var(--border);
    padding: 0.75rem;
    text-align: left;
  }

  .prose :global(th) {
    background: var(--chip);
    font-weight: 600;
  }

  .prose :global(strong) {
    font-weight: 700;
    color: var(--text);
  }

  .prose :global(hr) {
    border: none;
    border-top: 1px solid var(--border);
    margin: 2rem 0;
  }

  /* Share Section */
  .share-section {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 1rem;
    padding: 1.5rem;
    text-align: center;
    margin-bottom: 3rem;
  }

  .share-section h3 {
    font-size: 1rem;
    margin-bottom: 1rem;
    color: var(--text);
  }

  .share-buttons {
    display: flex;
    justify-content: center;
    flex-wrap: wrap;
    gap: 0.75rem;
  }

  .share-btn {
    padding: 0.5rem 1rem;
    border-radius: 0.5rem;
    font-size: 0.875rem;
    font-weight: 500;
    text-decoration: none;
    cursor: pointer;
    transition: transform 0.2s;
    border: none;
  }

  .share-btn:hover {
    transform: scale(1.05);
  }

  .share-btn.twitter {
    background: #000;
    color: #fff;
  }

  .share-btn.facebook {
    background: #1877f2;
    color: #fff;
  }

  .share-btn.copy {
    background: var(--chip);
    color: var(--text);
    border: 1px solid var(--border);
  }

  /* Related Posts */
  .related-posts {
    margin-bottom: 3rem;
  }

  .related-posts h2 {
    font-size: 1.25rem;
    margin-bottom: 1rem;
    color: var(--text);
  }

  .related-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
  }

  .related-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 0.75rem;
    padding: 1rem;
    text-decoration: none;
    transition: transform 0.2s;
  }

  .related-card:hover {
    transform: translateY(-2px);
  }

  .related-category {
    font-size: 0.7rem;
    font-weight: 600;
    text-transform: uppercase;
  }

  .related-card h3 {
    font-size: 0.9rem;
    font-weight: 600;
    color: var(--text);
    margin-top: 0.5rem;
    line-height: 1.4;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  /* CTA Section */
  .cta-section {
    margin-top: 2rem;
  }

  .cta-card {
    background: linear-gradient(135deg, var(--accent), var(--accent-2));
    border-radius: 1rem;
    padding: 2rem;
    text-align: center;
    color: white;
  }

  .cta-card h2 {
    font-size: 1.5rem;
    margin-bottom: 0.5rem;
  }

  .cta-card p {
    font-size: 0.95rem;
    opacity: 0.9;
    margin-bottom: 1rem;
  }

  .btn.primary {
    background: white;
    color: var(--accent);
    padding: 0.75rem 1.5rem;
    border-radius: 2rem;
    font-weight: 600;
    font-size: 0.95rem;
    text-decoration: none;
    display: inline-block;
    transition: transform 0.2s;
  }

  .btn.primary:hover {
    transform: scale(1.05);
  }

  @media (max-width: 768px) {
    .post-header h1 {
      font-size: 1.5rem;
    }

    .description {
      font-size: 1rem;
    }

    .prose :global(h2) {
      font-size: 1.25rem;
    }

    .related-grid {
      grid-template-columns: 1fr;
    }
  }
</style>
